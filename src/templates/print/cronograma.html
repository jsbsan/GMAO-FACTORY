<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Cronograma de Mantenimiento {{ year }}</title>
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
    <style>
        @media print {
            .no-print { display: none; }
            @page { size: landscape; margin: 1cm; }
            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .badge-status, .badge-legend { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; color-adjust: exact !important; }
        }
        body { padding: 20px; font-family: sans-serif; font-size: 0.8rem; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 4px; text-align: center; vertical-align: middle; }
        th { background-color: #f2f2f2; font-weight: bold; }
        .text-start { text-align: left; }
        .badge-status {
            font-size: 0.75em;
            padding: 2px 4px;
            border-radius: 3px;
            display: inline-block;
            margin: 1px;
            color: #fff;
            border: 1px solid #ccc;
        }
        .status-realizada { background-color: #198754 !important; color: white !important; border-color: #198754; }
        .status-en-curso { background-color: #ffc107 !important; color: #212529 !important; border-color: #ffc107; }
        .status-rechazada { background-color: #000000 !important; color: white !important; border-color: #000000; }
        .status-pendiente { background-color: #dc3545 !important; color: white !important; border-color: #dc3545; }
        .status-prevista { background-color: #6c757d !important; color: white !important; border-color: #6c757d; }
        .status-aplazada { background-color: #6f42c1 !important; color: white !important; border-color: #6f42c1; }
        
        .badge-legend {
            display: inline-block;
            padding: 3px 6px;
            font-size: 0.8em;
            font-weight: bold;
            border-radius: 4px;
            margin-right: 5px;
            border: 1px solid #999;
            color: white;
        }
    </style>
</head>
<body onload="window.print()">
    <div class="container-fluid">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2>Cronograma de Mantenimiento - Año {{ year }}</h2>
            <button class="btn btn-secondary no-print" onclick="window.close()">Cerrar</button>
        </div>

        <table class="table table-bordered table-sm">
            <thead>
                <tr>
                    <th style="width: 20%;">Actividad / Equipo</th>
                    {% for m in meses %}
                    <th>{{ m }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in data %}
                <tr>
                    <td class="text-start bg-light">
                        <strong>{{ row.actividad }}</strong><br>
                        <span class="text-muted">{{ row.equipo }}</span>
                    </td>
                    {% for month_idx in range(1, 13) %}
                    <td style="vertical-align: top;">
                        {% if month_idx in row.ots %}
                            {% for ot in row.ots[month_idx] %}<div class="badge-status {% if ot.estado == 'Realizada' %}status-realizada{% elif ot.estado == 'En curso' %}status-en-curso{% elif ot.estado == 'Pendiente' %}status-pendiente{% elif ot.estado == 'Prevista' %}status-prevista{% elif ot.estado == 'Aplazada' %}status-aplazada{% else %}status-rechazada{% endif %}" title="{{ ot.nombre }} ({{ ot.fecha }})" data-bs-toggle="modal" data-bs-target="#cronModalOT{{ ot.id }}">{{ ot.day_day }}</div><div class="modal fade text-start" id="cronModalOT{{ ot.id }}" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><form action="{{ url_for('update_ot', id=ot.id) }}" method="POST"><div class="modal-header"><h5 class="modal-title">{{ ot.nombre }}</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><input type="hidden" name="redirect_to" value="cronograma"><div class="alert alert-secondary"><strong>Operaciones:</strong><br>{{ ot.operaciones }}</div><div class="mb-3"><label class="form-label">Estado</label><select class="form-select" name="estado"><option value="En curso" {{ 'selected' if ot.estado == 'En curso' }}>En curso</option><option value="Pendiente" {{ 'selected' if ot.estado == 'Pendiente' }}>Pendiente</option><option value="Prevista" {{ 'selected' if ot.estado == 'Prevista' }}>Prevista</option><option value="Realizada" {{ 'selected' if ot.estado == 'Realizada' }}>Realizada</option><option value="Aplazada" {{ 'selected' if ot.estado == 'Aplazada' }}>Aplazada</option><option value="Rechazada" {{ 'selected' if ot.estado == 'Rechazada' }}>Rechazada</option></select></div><div class="mb-3"><label class="form-label">Observaciones</label><textarea class="form-control" name="observaciones">{{ ot.observaciones or '' }}</textarea></div><div class="mb-3"><label class="form-label">Fecha Realización</label><input type="date" class="form-control" name="fecha_realizada" value="{{ ot.fecha_realizada or '' }}"></div></div><div class="modal-footer"><button type="submit" class="btn btn-primary">Actualizar OT</button></div></form></div></div></div>{% endfor %}{% endif %}</td>{% endfor %}</tr>{% endfor %}</tbody></table></div><div class="mt-3"><small>Leyenda: <span class="badge bg-success">Realizada</span> <span class="badge bg-warning text-dark">En Curso</span> <span class="badge bg-danger">Pendiente</span> <span class="badge bg-secondary">Prevista</span> <span class="badge status-aplazada">Aplazada</span> <span class="badge bg-dark">Rechazada</span>. El número indica el día del mes. Haz click para editar.</small></div>
{% endblock %}