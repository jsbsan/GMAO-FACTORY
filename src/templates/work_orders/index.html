{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4"><h1 class="h2">Órdenes de Trabajo</h1><div class="d-flex gap-2"><a href="{{ url_for('print_all_ots') }}" class="btn btn-secondary" target="_blank"><i class="fas fa-print"></i> Imprimir Todo</a><form action="{{ url_for('generate_work_orders') }}" method="POST"><button type="submit" class="btn btn-warning"><i class="fas fa-sync-alt"></i> Generar OTs</button></form></div></div>
<div class="table-responsive"><table class="table table-hover align-middle datatable" id="tablaOTs"><thead class="table-dark"><tr><th>ID</th><th>Nombre OT</th><th>Equipo</th><th>Fecha Gen.</th><th>Estado</th><th>Acciones</th></tr></thead><tbody>{% for ot in ots %}<tr><td>{{ ot.id }}</td><td>{{ ot.nombre }}</td><td>{{ ot.equipo_nombre }}</td><td>{{ ot.fecha_generacion }}</td><td>{% if ot.estado == 'Realizada' %}<span class="badge bg-success">Realizada</span>{% elif ot.estado == 'En curso' %}<span class="badge bg-warning text-dark">En curso</span>{% elif ot.estado == 'Pendiente' %}<span class="badge bg-danger">Pendiente</span>{% elif ot.estado == 'Prevista' %}<span class="badge bg-secondary">Prevista</span>{% elif ot.estado == 'Aplazada' %}<span class="badge status-aplazada">Aplazada</span>{% else %}<span class="badge bg-dark">Rechazada</span>{% endif %}</td><td><a href="{{ url_for('print_ot', id=ot.id) }}" class="btn btn-sm btn-secondary" target="_blank"><i class="fas fa-print"></i></a> <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#modalOT{{ ot.id }}">Gestionar</button><div class="modal fade" id="modalOT{{ ot.id }}" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><form action="{{ url_for('update_ot', id=ot.id) }}" method="POST"><div class="modal-header"><h5 class="modal-title">{{ ot.nombre }}</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="alert alert-secondary"><strong>Operaciones:</strong><br>{{ ot.operaciones }}</div><div class="mb-3"><label class="form-label">Estado</label><select class="form-select" name="estado"><option value="En curso" {{ 'selected' if ot.estado == 'En curso' }}>En curso</option><option value="Pendiente" {{ 'selected' if ot.estado == 'Pendiente' }}>Pendiente</option><option value="Prevista" {{ 'selected' if ot.estado == 'Prevista' }}>Prevista</option><option value="Realizada" {{ 'selected' if ot.estado == 'Realizada' }}>Realizada</option><option value="Aplazada" {{ 'selected' if ot.estado == 'Aplazada' }}>Aplazada</option><option value="Rechazada" {{ 'selected' if ot.estado == 'Rechazada' }}>Rechazada</option></select></div><div class="mb-3"><label class="form-label">Observaciones</label><textarea class="form-control" name="observaciones">{{ ot.observaciones }}</textarea></div><div class="mb-3"><label class="form-label">Fecha Realización</label><input type="date" class="form-control" name="fecha_realizada" value="{{ ot.fecha_realizada }}"></div></div><div class="modal-footer"><button type="submit" class="btn btn-primary">Actualizar OT</button></div></form></div></div></div></td></tr>{% endfor %}</tbody></table></div>
{% endblock %}